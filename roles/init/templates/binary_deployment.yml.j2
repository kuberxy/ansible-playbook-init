---

{% raw %}
- include_vars: file={{ local_conf_dir }}/packages_info.yml

- name: copy binary packages
  copy: src={{ local_download_dir }}/{{ item.name }}-{{ item.version }}.tar.gz dest=/tmp owner={{ deploy_user }} group={{ deploy_user }} mode=0755
  loop: "{{ binary_name }}"

- name: unarchive binary packages
  unarchive:
    src: "{{ local_download_dir }}/{{ item.name }}-{{ item.version }}.tar.gz"
    dest: "{{ deploy_dir }}"
    owner: "{{ deploy_user }}"
    group: "{{ deploy_user }}"
  with_items: "{{ packages_info }}"
  when: item.name in image_name

- name: create run script
  template:
    src: "run_{{ role_name }}_binary.sh.j2"
    dest: "{{ script_dir }}/run_{{ role_name }}_{{ redis_port }}.sh"
    owner: "{{ deploy_user }}"
    group: "{{ deploy_user }}"
    mode: "0755"
    backup: yes
  with_items:
    - run

- include_tasks: "{{ process_supervision_method }}_supervision.yml"
{% endraw %}
